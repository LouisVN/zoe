<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="Zoe - The Kafka companion"><meta name="author" content="Adevinta"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Zoe with Avro - Zoe - The Kafka Companion</title><link rel="stylesheet" href="../../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#7e57c2"><script src="../../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../../assets/fonts/material-icons.css"></head><body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="indigo"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#zoe-with-avro" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="../../.." title="Zoe - The Kafka Companion" class="md-header-nav__button md-logo"><i class="md-icon"></i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Zoe - The Kafka Companion</span><span class="md-header-nav__topic">Zoe with Avro</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/adevinta/zoe/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">adevinta/zoe</div></a></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="../../.." title="Zoe - The Kafka Companion" class="md-nav__button md-logo"><i class="md-icon"></i></a>Zoe - The Kafka Companion</label><div class="md-nav__source"><a href="https://github.com/adevinta/zoe/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">adevinta/zoe</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../.." title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Install</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Install</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../install/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../../install/package/" title="Platform packages" class="md-nav__link">Platform packages</a></li><li class="md-nav__item"><a href="../../../install/homebrew/" title="Homebrew" class="md-nav__link">Homebrew</a></li><li class="md-nav__item"><a href="../../../install/tarball/" title="Tarball install" class="md-nav__link">Tarball install</a></li><li class="md-nav__item"><a href="../../../install/docker/" title="Docker" class="md-nav__link">Docker</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">Getting started</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">Getting started</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../basics/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../../basics/prepare/" title="Prepare the environment" class="md-nav__link">Prepare the environment</a></li><li class="md-nav__item"><a href="../../../basics/produce/" title="Producing data" class="md-nav__link">Producing data</a></li><li class="md-nav__item"><a href="../../../basics/consume/" title="Consuming data" class="md-nav__link">Consuming data</a></li><li class="md-nav__item"><a href="../../../basics/operations/" title="Operations" class="md-nav__link">Operations</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">Configuration</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Configuration</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../configuration/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../../configuration/init/" title="Config initialization" class="md-nav__link">Config initialization</a></li><li class="md-nav__item"><a href="../../../configuration/environments/" title="Environments" class="md-nav__link">Environments</a></li><li class="md-nav__item"><a href="../../../configuration/chain/" title="Configuration loading chain" class="md-nav__link">Configuration loading chain</a></li><li class="md-nav__item"><a href="../../../configuration/reference/" title="Reference" class="md-nav__link">Reference</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5"><label class="md-nav__link" for="nav-5">Advanced usage</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">Advanced usage</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../advanced/avro/" title="Using avro and schema registry" class="md-nav__link">Using avro and schema registry</a></li><li class="md-nav__item"><a href="../../../advanced/expressions/" title="Registered expressions" class="md-nav__link">Registered expressions</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3"><label class="md-nav__link" for="nav-5-3">Secrets provider</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-3">Secrets provider</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../advanced/secrets/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../../advanced/secrets/envvars/" title="Environment variables provider" class="md-nav__link">Environment variables provider</a></li><li class="md-nav__item"><a href="../../../advanced/secrets/strongbox/" title="Strongbox provider" class="md-nav__link">Strongbox provider</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4"><label class="md-nav__link" for="nav-5-4">Runners in depth</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-4">Runners in depth</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../advanced/runners/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../../advanced/runners/local/" title="Local" class="md-nav__link">Local</a></li><li class="md-nav__item"><a href="../../../advanced/runners/lambda/" title="Lambda" class="md-nav__link">Lambda</a></li><li class="md-nav__item"><a href="../../../advanced/runners/kubernetes/" title="Kubernetes" class="md-nav__link">Kubernetes</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked><label class="md-nav__link" for="nav-6">Guides</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-6">Guides</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../simple/guide/" title="Basic scenario" class="md-nav__link">Basic scenario</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Zoe with Avro</label><a href="./" title="Zoe with Avro" class="md-nav__link md-nav__link--active">Zoe with Avro</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#what-you-will-learn" title="What you will learn" class="md-nav__link">What you will learn</a></li><li class="md-nav__item"><a href="#prerequisites" title="Prerequisites" class="md-nav__link">Prerequisites</a></li><li class="md-nav__item"><a href="#prepare-the-environment" title="Prepare the environment" class="md-nav__link">Prepare the environment</a></li><li class="md-nav__item"><a href="#configure-zoe" title="Configure zoe" class="md-nav__link">Configure zoe</a></li><li class="md-nav__item"><a href="#creating-the-cat-facts-avro-schema-with-zoe" title="Creating the Cat Facts Avro schema with zoe" class="md-nav__link">Creating the Cat Facts Avro schema with zoe</a></li><li class="md-nav__item"><a href="#producing-data" title="Producing data" class="md-nav__link">Producing data</a></li><li class="md-nav__item"><a href="#reading-data" title="Reading data" class="md-nav__link">Reading data</a></li></ul></nav></li><li class="md-nav__item"><a href="../../kubernetes/guide/" title="Zoe with Kubernetes" class="md-nav__link">Zoe with Kubernetes</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#what-you-will-learn" title="What you will learn" class="md-nav__link">What you will learn</a></li><li class="md-nav__item"><a href="#prerequisites" title="Prerequisites" class="md-nav__link">Prerequisites</a></li><li class="md-nav__item"><a href="#prepare-the-environment" title="Prepare the environment" class="md-nav__link">Prepare the environment</a></li><li class="md-nav__item"><a href="#configure-zoe" title="Configure zoe" class="md-nav__link">Configure zoe</a></li><li class="md-nav__item"><a href="#creating-the-cat-facts-avro-schema-with-zoe" title="Creating the Cat Facts Avro schema with zoe" class="md-nav__link">Creating the Cat Facts Avro schema with zoe</a></li><li class="md-nav__item"><a href="#producing-data" title="Producing data" class="md-nav__link">Producing data</a></li><li class="md-nav__item"><a href="#reading-data" title="Reading data" class="md-nav__link">Reading data</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><a href="https://github.com/adevinta/zoe/edit/master/docs/guides/avro/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a><h1 id="zoe-with-avro">Zoe with Avro</h1>
<p>This tutorial shows zoe support for avro and the schema registry. If you are new to zoe, start with <a href="../../simple/guide/">the basic scenario</a>.</p>
<h2 id="what-you-will-learn">What you will learn</h2>
<p>In this tutorial, you will learn the following aspects of zoe:</p>
<ul>
<li>Configure zoe to use against avro topics.</li>
<li>Listing avro schemas registered in the schema registry</li>
<li>Deploying <code>.avdl</code> avro schemas</li>
<li>Writing json data into kafka topics using avro</li>
<li>Reading avro data from a topic</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>For this guide you will need:</p>
<ul>
<li>Zoe (install instructions are <a href="../../../install/overview/">here</a>)</li>
<li>Docker and docker-compose (that we will use to spin up Kafka)</li>
</ul>
<h2 id="prepare-the-environment">Prepare the environment</h2>
<ul>
<li>Clone the <a href="https://github.com/adevinta/zoe">repository</a>: <code>git clone https://github.com/adevinta/zoe.git</code></li>
<li>Go to the directory: <code>docs/guides/avro</code></li>
<li>Spin up the kafka cluster: <code>docker-compose up -d</code>.</li>
<li>Check all the containers are up:</li>
</ul>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>docker-compose ps      
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  Name               Command            State                        Ports                      
------------------------------------------------------------------------------------------------
broker      /etc/confluent/docker/run   Up      0.0.0.0:29092-&gt;29092/tcp, 0.0.0.0:9092-&gt;9092/tcp
zookeeper   /etc/confluent/docker/run   Up      0.0.0.0:2181-&gt;2181/tcp, 2888/tcp, 3888/tcp      
</pre></div></div>
</div>
<h2 id="configure-zoe">Configure zoe</h2>
<p>Now, we need to configure zoe to make it aware of the cluster.</p>
<p>Create a new file called <code>default.yml</code> inside zoe's config directory (<code>~/.zoe/config</code> by default) and fill it with the following content:</p>
<div class="superfences-tabs">
<input name="__tabs_2" type="radio" id="__tab_2_0" checked="checked" />
<label for="__tab_2_0">~/.zoe/config/default.yml</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="nt">clusters</span><span class="p">:</span>
  <span class="nt">default</span><span class="p">:</span>
    <span class="nt">props</span><span class="p">:</span>
      <span class="nt">bootstrap.servers</span><span class="p">:</span> <span class="s">&quot;localhost:29092&quot;</span>
      <span class="nt">key.deserializer</span><span class="p">:</span> <span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>
      <span class="nt">value.deserializer</span><span class="p">:</span> <span class="s">&quot;io.confluent.kafka.serializers.KafkaAvroDeserializer&quot;</span>
      <span class="nt">key.serializer</span><span class="p">:</span> <span class="s">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>
      <span class="nt">value.serializer</span><span class="p">:</span> <span class="s">&quot;io.confluent.kafka.serializers.KafkaAvroSerializer&quot;</span>

    <span class="nt">registry</span><span class="p">:</span> <span class="s">&quot;http://localhost:8081&quot;</span>

    <span class="nt">topics</span><span class="p">:</span>
      <span class="nt">input</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;input-events-topic&quot;</span>
        <span class="nt">subject</span><span class="p">:</span> <span class="s">&quot;input-events-topic-value&quot;</span>

<span class="nt">runners</span><span class="p">:</span>
  <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;local&quot;</span>
</pre></div></div>
</div>
<p>The <a href="../../simple/guide/">basic scenario</a> guide explains most of the configuration above. The relevant parts for this guide are the following:</p>
<ul>
<li>In the <code>default</code> cluster's configuration, notice the <code>registry</code> key. This defines the address of the <a href="https://docs.confluent.io/current/schema-registry/schema_registry_tutorial.html">schema registry</a> where avro schemas are stored. When we define this key, zoe automatically adds the <code>schema.registry.url</code> property to the consumers and producers and there is no need to supply it manually.</li>
<li>Notice also that we are using the <code>KafkaAvroDeserializer</code> and <code>KafkaAvroSerializer</code> in the cluster's client properties.</li>
<li>In the topics section, besides the name of the topic, we define the subject name of the schema associated with the topic. This is an optional parameter that is only used when producing data into the topic so that zoe serializes the data using the right Avro schema. You can also override it with the <code>--subject</code> option in the <code>topics produce</code> command. </li>
</ul>
<p>If you don't want to write this configuration by hand, you can copy the one already present in the repository by using the following command:</p>
<div class="superfences-tabs">
<input name="__tabs_3" type="radio" id="__tab_3_0" checked="checked" />
<label for="__tab_3_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>zoe config init --from git --url https://github.com/adevinta/zoe --dir docs/guides/avro/config
</pre></div></div>
</div>
<p>Ensure zoe is now aware of the cluster by executing the following command:</p>
<div class="superfences-tabs">
<input name="__tabs_4" type="radio" id="__tab_4_0" checked="checked" />
<label for="__tab_4_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>zoe --silent -o table config clusters list
</pre></div></div>
<input name="__tabs_4" type="radio" id="__tab_4_1" />
<label for="__tab_4_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>┌─────────┬─────────────────┬───────────────────────┬────────────────────────────────────────────┬────────┐
│ cluster │ brokers         │ registry              │ topics                                     │ groups │
├─────────┼─────────────────┼───────────────────────┼────────────────────────────────────────────┼────────┤
│ default │ localhost:29092 │ http://localhost:8081 │ alias: &quot;input&quot;  name: &quot;input-events-topic&quot; │        │
└─────────┴─────────────────┴───────────────────────┴────────────────────────────────────────────┴────────┘
</pre></div></div>
</div>
<p>Now, you're ready to use zoe to interact with the local kafka cluster. This cluster is available in the provided config above under the <code>local</code> alias (take a look at <code>zoe-config/default.yml</code>)</p>
<h2 id="creating-the-cat-facts-avro-schema-with-zoe">Creating the Cat Facts Avro schema with zoe</h2>
<p>In this guide we will be using again the cat facts data that we used in the <a href="../../simple/guide/">basic scenario guide</a>. This time though we will serialize this data in Avro. So the first step is to create the Avro schema representing this data!</p>
<p>The Avro schema representing the Cat Facts dataset is provided <a href="../schema.avdl">in the repository</a>. It is written in <code>.avdl</code> which is a format that describes avro schemas in an expressive and intuitive way. You can know more about <code>avdl</code> <a href="https://avro.apache.org/docs/current/idl.html">here</a></p>
<p>Usually, to deploy an <code>.avdl</code> file into the schema registry we first need to compile it down into an <code>.avsc</code> file before posting it to the registry. With zoe, this compilation step is done automatically for us. In fact, zoe handles <code>.avdl</code> files as seamlessly as <code>.avsc</code> files.</p>
<div class="superfences-tabs">
<input name="__tabs_5" type="radio" id="__tab_5_0" checked="checked" />
<label for="__tab_5_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1"># deploy the cat facts schema from the </span>
zoe schemas deploy <span class="se">\</span>
  --avdl <span class="se">\</span>
  --from-file schema.avdl <span class="se">\</span>
  --name CatFact <span class="se">\</span>
  --strategy topic <span class="se">\</span>
  --topic input <span class="se">\</span>
  --suffix value
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_1" />
<label for="__tab_5_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>2020-06-28 09:38:29 INFO zoe: loading config from url : file:/tmp/zoe-avro/default.yml
{&quot;type&quot;:&quot;actual&quot;,&quot;id&quot;:1,&quot;subject&quot;:&quot;input-events-topic-value&quot;}
</pre></div></div>
</div>
<p>Ensure our schema is successfully registered by listing the topics from the schema registry:</p>
<div class="superfences-tabs">
<input name="__tabs_6" type="radio" id="__tab_6_0" checked="checked" />
<label for="__tab_6_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>zoe --silent -o table schemas list
</pre></div></div>
<input name="__tabs_6" type="radio" id="__tab_6_1" />
<label for="__tab_6_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>┌──────────────────────────┐
│ subjects                 │
├──────────────────────────┤
│ input-events-topic-value │
└──────────────────────────┘
</pre></div></div>
</div>
<p>Describe the schema using:</p>
<div class="superfences-tabs">
<input name="__tabs_7" type="radio" id="__tab_7_0" checked="checked" />
<label for="__tab_7_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>zoe --silent -o table schemas describe input-events-topic-value
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_1" />
<label for="__tab_7_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>┌──────────────────────────┬──────────┬─────────────────────────────────────────────────────────────────────────────────────────────┐
│ subject                  │ versions │ latest                                                                                      │
├──────────────────────────┼──────────┼─────────────────────────────────────────────────────────────────────────────────────────────┤
│ input-events-topic-value │ 1        │ {&quot;type&quot;:&quot;record&quot;,&quot;name&quot;:&quot;CatFact&quot;,&quot;namespace&quot;:&quot;com.adevinta.oss.zoe.guides&quot;,&quot;fields&quot;:[...]} │
└──────────────────────────┴──────────┴─────────────────────────────────────────────────────────────────────────────────────────────┘
</pre></div></div>
</div>
<h2 id="producing-data">Producing data</h2>
<p>No that we have the Cat Facts Avro schema registered, let's produce some cat facts from the <code>data.json</code> file in avro:</p>
<div class="superfences-tabs">
<input name="__tabs_8" type="radio" id="__tab_8_0" checked="checked" />
<label for="__tab_8_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>zoe topics produce --topic input --from-file data.json --subject input-events-topic-value
</pre></div></div>
<input name="__tabs_8" type="radio" id="__tab_8_1" />
<label for="__tab_8_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>2020-06-28 09:48:11 INFO zoe: loading config from url : file:/tmp/zoe-avro/default.yml
2020-06-28 09:48:11 INFO zoe: producing &#39;211&#39; records to topic &#39;input-events-topic&#39;
2020-06-28 09:48:12 INFO AppInfoParser: Kafka version: 5.5.0-ccs
2020-06-28 09:48:12 INFO AppInfoParser: Kafka commitId: 785a156634af5f7e
2020-06-28 09:48:12 INFO AppInfoParser: Kafka startTimeMs: 1593330492339
2020-06-28 09:48:12 INFO Metadata: [Producer clientId=producer-1] Cluster ID: pD8UlIdIQkyn40_NW_-f4w
2020-06-28 09:48:12 INFO KafkaProducer: [Producer clientId=producer-1] Closing the Kafka producer with timeoutMillis = 9223372036854775807 ms.
┌─────────────────────────────────────────────────────────────────────────────────┬─────────┐
│ produced                                                                        │ skipped │
├─────────────────────────────────────────────────────────────────────────────────┼─────────┤
│ offset: 43  partition: 0  topic: &quot;input-events-topic&quot;  timestamp: 1593330492564 │         │
│ offset: 31  partition: 2  topic: &quot;input-events-topic&quot;  timestamp: 1593330492591 │         │
│ offset: 47  partition: 1  topic: &quot;input-events-topic&quot;  timestamp: 1593330492591 │         │
│ offset: 48  partition: 1  topic: &quot;input-events-topic&quot;  timestamp: 1593330492591 │         │
│ offset: 50  partition: 4  topic: &quot;input-events-topic&quot;  timestamp: 1593330492591 │         │
│ offset: 86  partition: 3  topic: &quot;input-events-topic&quot;  timestamp: 1593330492619 │         │
| ...                                                                             |         |
│ offset: 89  partition: 1  topic: &quot;input-events-topic&quot;  timestamp: 1593330492619 │         │
│ offset: 96  partition: 0  topic: &quot;input-events-topic&quot;  timestamp: 1593330492619 │         │
└─────────────────────────────────────────────────────────────────────────────────┴─────────┘
</pre></div></div>
</div>
<p>We could have omitted the <code>--subject</code> option as we have already told zoe about that topic's subject name in the configuration (see above).</p>
<p>When zoe sees that we are using the <code>KafkaAvroDeserializer</code>, it automatically tries to convert data from json into Avro <a href="https://avro.apache.org/docs/1.7.6/api/java/org/apache/avro/generic/GenericRecord.html">Generic Records</a> before supplying them to the producer.</p>
<h2 id="reading-data">Reading data</h2>
<p>Reading data from an Avro topic with zoe is really no different from reading a Json topic. Zoe seemlessly transforms avro data into json and zoe can apply the jmespath filters with <code>--filter</code> as with json data. In fact the following command works exactly the same in both this guide and the <a href="../../simple/guide/">Basic scenario</a> one:</p>
<div class="superfences-tabs">
<input name="__tabs_9" type="radio" id="__tab_9_0" checked="checked" />
<label for="__tab_9_0">command</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1"># filter out Kasimir&#39;s data</span>
zoe --silent -o table topics consume input <span class="se">\</span>
       -n <span class="m">10</span> <span class="se">\</span>
       --from <span class="s1">&#39;PT1h&#39;</span> <span class="se">\</span>
       --query <span class="s1">&#39;{id: _id, type: type, user: user, upvotes: upvotes}&#39;</span> <span class="se">\</span>
       --filter <span class="s2">&quot;user.name.first == &#39;Kasimir&#39;&quot;</span>
</pre></div></div>
<input name="__tabs_9" type="radio" id="__tab_9_1" />
<label for="__tab_9_1">output</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>┌──────────────────────────┬──────┬───────────────────────────────────────────┬─────────┐
│ id                       │ type │ user                                      │ upvotes │
├──────────────────────────┼──────┼───────────────────────────────────────────┼─────────┤
│ 58e008d00aac31001185ed0f │ cat  │ _id: &quot;58e007480aac31001185ecef&quot;           │ 2       │
│                          │      │ name: {&quot;first&quot;:&quot;Kasimir&quot;,&quot;last&quot;:&quot;Schulz&quot;} │         │
├──────────────────────────┼──────┼───────────────────────────────────────────┼─────────┤
│ 58e00b3a0aac31001185ed20 │ cat  │ _id: &quot;58e007480aac31001185ecef&quot;           │ 2       │
│                          │      │ name: {&quot;first&quot;:&quot;Kasimir&quot;,&quot;last&quot;:&quot;Schulz&quot;} │         │
├──────────────────────────┼──────┼───────────────────────────────────────────┼─────────┤
│ 58e00a090aac31001185ed16 │ cat  │ _id: &quot;58e007480aac31001185ecef&quot;           │ 4       │
│                          │      │ name: {&quot;first&quot;:&quot;Kasimir&quot;,&quot;last&quot;:&quot;Schulz&quot;} │         │
├──────────────────────────┼──────┼───────────────────────────────────────────┼─────────┤
│ 58e008d00aac31001185ed0f │ cat  │ _id: &quot;58e007480aac31001185ecef&quot;           │ 2       │
│                          │      │ name: {&quot;first&quot;:&quot;Kasimir&quot;,&quot;last&quot;:&quot;Schulz&quot;} │         │
├──────────────────────────┼──────┼───────────────────────────────────────────┼─────────┤
│ 58e00bdb0aac31001185edfd │ cat  │ _id: &quot;58e007480aac31001185ecef&quot;           │ 2       │
│                          │      │ name: {&quot;first&quot;:&quot;Kasimir&quot;,&quot;last&quot;:&quot;Schulz&quot;} │         │
└──────────────────────────┴──────┴───────────────────────────────────────────┴─────────┘
</pre></div></div>
</div></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../../simple/guide/" title="Basic scenario" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>Basic scenario</span></div></a><a href="../../kubernetes/guide/" title="Zoe with Kubernetes" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>Zoe with Kubernetes</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">Copyright (c) 2020 Adevinta</div>powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script></body></html>